/*!
 * app.classparser.js Javascript Library v0.9.2
 *
 * Copyright (c) 2011 Fabian Irsara
 * Licensed under the GPL Version 2 licenses.
 * 
 * Provides prototypal inheritence of self-defined Classes
 * Parsing Classes
 */

/*!
 * app.js Javascript Library v0.9.2
 *
 * Copyright (c) 2011 Fabian Irsara
 * Licensed under the GPL Version 2 licenses.
 * 
 * Provides prototypal inheritence of self-defined Classes
 * Parsing Classes
 * Requiring, extending Classes
 * including Plugins and Stylesheets Dynamically
 */

var app,ClassParser;app=(function(l,m){"use strict";l.VERSION=0.92;l.NAME='app';l.MINIFY_JS=false;l.CACHE=false;l.BASE_PATH='';var n=[];var o={};var p=0;var q=function(){this.self=this;this.priv={}};var r,include,searchHeadElement,appendHeadElement,checkRequirements,inArray,checkForClass,gotClass,internalParse;var s=m.document;l.Class=function(a){this.className='';this.classConstructor=null;this.superClass='Class';this.imports=[];this.plugins=[];this.callback=null;for(var k in a){if(k!=='indexOf'){this[k]=a[k]}}};l.ignore=function(a){n[a]=true};l.run=function(a,b){include(a,b,null,true)};l.style=l.css=function(a,b){a=a.trim();if(!a.endsWith('.css')&&l.BASE_PATH!==''){a=l.BASE_PATH+a+'.css'}if(!l.CACHE){if(a.indexOf('?')!==-1){a+='&'}else{a+='?'}a+='t='+new Date().getTime()}if(searchHeadElement('link',{'data-includemodule':a})){if(b){b.call(l,null)}return}appendHeadElement('link',{'class':'style-includemodule','data-includemodule':a,'rel':'stylesheet',type:'text/css','charset':'utf-8',href:a})};l.remove=function(a,b,c){if(!(a instanceof Array)){a=[a]}if(b===null){b=true}if(c===null){c=false}var d,scriptUID,i,j;for(i=0;i<a.length;i++){scriptUID=a[i].trim();if(n[scriptUID]===true){continue}d=searchHeadElement('script',{'data-includemodule':scriptUID});if(d){d.parentNode.removeChild(d)}if(!o[scriptUID]){continue}if(b&&o[scriptUID].imports){for(j=0;j<o[scriptUID].imports.length;j++){l.remove(o[scriptUID].imports[j])}}if(c&&o[scriptUID].plugins){for(j=0;j<o[scriptUID].plugins.length;j++){l.remove(o[scriptUID].plugins[j])}}o[scriptUID]=null}};l.requires=l.require=l.js=function(a,b,c){if(!(a instanceof Array)){a=[a]}var d,dependencyNotFound,loaded=-1;d=function(){loaded++;if(a[loaded]){include(a[loaded],d,dependencyNotFound)}};dependencyNotFound=function(){if(c){c(a[loaded])}if(!o[a[loaded]]){o[a[loaded]]={}}o[a[loaded]].ready=true;d()};d();if(b){checkRequirements(a,b)}};l.defineClass=function(a){if(!o[a.className]){o[a.className]=a}for(var i=0;i<o[a.className].plugins.length;i++){o[a.className].imports.push(o[a.className].plugins[i])}o[a.className].loadID=p;o[a.className].size=a.imports.length;if(o[a.className].size>0){l.requires(o[a.className].imports)}p++;checkForClass(a.className)};var t=Object.prototype.hasOwnProperty;l.__extend=function(a,b){var c={prototypes:{},statics:{}},k;for(k in a){if(k!=='indexOf'){c.statics[k]=a[k]}}for(k in a.prototype){if(k!=='indexOf'){c.prototypes[k]=a.prototype[k]}}for(var d in b){if(t.call(b,d)){a[d]=b[d]}}function Ctor(){this.constructor=a;this.self=this}Ctor.prototype=b.prototype;a.prototype=new Ctor();a.__super__=b.prototype;for(k in c.statics){if(k!=='indexOf'){a[k]=c.statics[k]}}for(k in c.prototypes){if(k!=='indexOf'){a.prototype[k]=c.prototypes[k]}}return a};l.extendClass=function(c,d,e){var f=o[c].classConstructor;var g=o[d].classConstructor;l.__extend(f,g);f.__extend__=function(a,b){f.__super__.constructor.apply(a,b)};if(e){e.call(this)}return f};checkForClass=function(b){function checkForImportedClass(){var a=o[b];if(!a){return}a.ready=true;for(var i=0;i<a.size;i++){if(!o[a.imports[i]]){a.ready=false}else{if(o[a.imports[i]].loadID>a.loadID){if(o[a.imports[i]].ready!==true){a.ready=false}}}}if(a.ready===true&&o[b]&&o[a.superClass]){l.extendClass(b,a.superClass);gotClass(a.className);if(a.callback){a.callback.call(l,null)}}else{m.setTimeout(checkForImportedClass,10)}}checkForImportedClass()};l.hasClass=function(a){try{if(o[a].ready===true&&o[o[a].superClass].ready===true){return true}}catch(e){}return false};checkRequirements=function(a,b){function checkForRequirements(){for(var i=0;i<a.length;i++){if(l.hasClass(a[i])===false){return m.setTimeout(checkForRequirements,25)}else{if(b){b.call(l,null)}}}}checkForRequirements()};inArray=function(a,b){var i,size=a.length;for(i=0;i<size;i++){if(a[i]===b){return true}}return false};include=l.include=function(b,c,d,e,f){b=b.trim();var g=b;var h=searchHeadElement('script',{'data-includemodule':g});if(h){if(e){h.parentNode.removeChild(h)}else if(c){return c.call(l,null)}}if(n[g]===true){if(c){return c.call(l,null)}}var i=appendHeadElement('script',{'class':'script-includemodule','data-includemodule':g,'type':'text/javascript'});if(!f){f=true}if(!b.endsWith('.js')&&l.BASE_PATH!==''){b=l.BASE_PATH+b+'.js'}if(!l.CACHE){if(b.indexOf('?')!==-1){b+='&'}else{b+='?'}b+='t='+new Date().getTime()}r('GET',b,function(a){if(e===true){if(f){i.text=a}if(c){c.call(l,a)}}else if(a.indexOf(' class ')!==-1){if(c){c.call(l,a)}i.text=l.parseClass(a)}else{if(f){i.text=a;if(a.indexOf(l.NAME+'.defineClass(')===-1){gotClass(g)}}if(c){c.call(l,a)}}},function(a){i.parentNode.removeChild(i);if(d){d.call(l,a)}})};gotClass=function(a){if(!o[a]){o[a]={}}o[a].ready=true};gotClass('SuperClass');o.SuperClass.classConstructor=q;appendHeadElement=function(a,b){var c=s.createElement(a);for(var k in b){if(k!=='indexOf'){c.setAttribute(k,b[k])}}s.getElementsByTagName('head').item(0).appendChild(c);return c};searchHeadElement=function(a,b){var c=s.getElementsByTagName(a);var d=false;var e;for(var i=0;i<c.length;i++){d=true;for(var k in b){if(k!=='indexOf'){e=c[i].getAttribute(k);if(!e||e.toString()!==b[k].toString()){d=false}}}if(d===true){return c[i]}}return false};r=function(a,b,c,d){var f=false;if(m.XMLHttpRequest&&!(m.ActiveXObject)){try{f=new XMLHttpRequest()}catch(e){f=false}}else if(m.ActiveXObject){try{f=new m.ActiveXObject("Msxml2.XMLHTTP")}catch(e2){try{f=new m.ActiveXObject("Microsoft.XMLHTTP")}catch(e3){f=false}}}if(!f){d("Your Browser does not Support Ajax Requests");return false}f.onreadystatechange=function(){if(f.readyState.toString()==='4'){if(f.status.toString()==='200'||f.status.toString()==='0'){c(f.responseText)}else{d("There was a problem retrieving the XML data:\n"+f.statusText)}f=null}};f.open(a,b,true);f.send()};l.parseClass=l.parse=function(a){if(!(a instanceof Array)){a=[a]}var b='';for(var i=0;i<a.length;i++){b+=internalParse(a[i])}return b};internalParse=function(a){var b=new ClassParser(a);return b.parse()};if(!(m.console)||!(m.console.log)){m.console={};m.console.log=function(){}}if(!Function.prototype.bind){Function.prototype.bind=function(){var a=this,args=Array.prototype.slice.call(arguments),object=args.shift();return function(){return a.apply(object,args.concat(Array.prototype.slice.call(arguments)))}}}String.prototype.trim=function(){var a=this.replace(/^\s\s*/,''),ws=/\s/,i=a.length;do{i--}while(ws.test(a.charAt(i)));return a.slice(0,i+1)};String.prototype.endsWith=function(a){return(this.substring(this.length-a.length)===a)};var u=(s.getElementsByTagName('script'));var v=null,cache,minify,dir;for(var i=0;i<u.length;i++){cache=u[i].getAttribute('data-cache');minify=u[i].getAttribute('data-minify');dir=u[i].getAttribute('data-dir');if(cache&&cache.toString().toLowerCase()==='true'){l.CACHE=true}if(minify&&minify.toString().toLowerCase()==='true'){l.MINIFY_JS=true}if(dir){l.BASE_PATH=u[i].getAttribute('data-dir')}if(u[i].getAttribute('data-main')){v=u[i].getAttribute('data-main');if(u[i].getAttribute('data-dir')){l.BASE_PATH=u[i].getAttribute('data-dir')}else{l.BASE_PATH=v.substring(0,v.lastIndexOf('/')+1)}if((v.substring(v.length-3)!=='.js')&&(v.indexOf(l.BASE_PATH)===0)){v=v.substring(l.BASE_PATH.length)}}}if(v){l.requires(v)}return l}({},window));ClassParser=(function(k,l){"use strict";function ClassParser(a){a=a.replace(new RegExp("\\$","g"),"__DOLLAR__");this.string=a;this.pkg=null;this.imports=[];this.includes=[];this.styles=[];this.constructorFct=null;this.className=null;this.superClass=null;this.qualifiedClassName=null;this.publicFct=[];this.privateFct=[];this.privateVar=[];this.publicVar=[];this.superVar=[];this.publicStaticFct=[];this.publicStaticVar=[];this.privateStaticFct=[];this.privateStaticVar=[];this.string=this.string.replace(/([\/]{2}[^\n]*)|([\n]{1,}[\/]{2}[^\n]*)/g,'');this.string=this.string.replace(/\/\*([\s\S]*?)\*\//g,'');this.string=this.string.replace(/static public/g,'public static');this.string=this.string.replace(/static private/g,'private static');this.string=this.string.replace(/const /g,'var ');this.isStaticClass=(this.string.indexOf('public static class')>=0);this.hasSuperClass=(this.string.indexOf(' extends ')>=0);this.hasPackage=(this.string.indexOf('package ')>=0);var i;var b=(this.isStaticClass===true?'public static class':'public class');this.pkg=this.fetchResource('#package');while(this.string.indexOf('#import')>=0){this.imports.push(this.fetchResource('#import').replace(/\./g,'/'))}while(this.string.indexOf('#include')>=0){this.includes.push(this.fetchResource('#include'))}while(this.string.indexOf('#style')>=0){this.styles.push(this.fetchResource('#style'))}var c='';var d='';while(this.string.indexOf('#use')>=0){d=this.fetchResource('#use');c=d.substring(d.lastIndexOf('.'));this.string=this.string.replace(new RegExp("new?"+c,"g"),'new '+d);this.string=this.string.replace(new RegExp('extends?'+c,"g"),'extends '+d)}this.string=this.string.trim();this.className=this.string.substring(0,this.string.indexOf((this.hasSuperClass?'extends':'{'))).replace(b,'').trim().replace(/\n/g,'');this.superClass=this.string.substring(this.string.indexOf('extends'),this.string.indexOf('{')).replace('extends','').trim();this.qualifiedClassName=(this.hasPackage?(this.pkg+'.'+this.className):this.className);if(!this.hasSuperClass){this.superClass='SuperClass'}this.string=this.string.substring(this.string.indexOf('{')+1,this.string.lastIndexOf('}'));this.constructorFct=this.parseFunction('public',this.className);var e=(this.constructorFct.found===true&&this.hasSuperClass===true);while(this.string.indexOf('public static var ')>=0){this.publicStaticVar.push(this.parseVar('public static'))}while(this.string.indexOf('public static function ')>=0){this.publicStaticFct.push(this.parseFunction('public static'))}while(this.string.indexOf('private static var ')>=0){this.privateStaticVar.push(this.parseVar('private static'))}while(this.string.indexOf('private static function ')>=0){this.privateStaticFct.push(this.parseFunction('private static'))}while(this.string.indexOf('public var ')>=0){this.publicVar.push(this.parseVar('public'))}while(this.string.indexOf('private var ')>=0){this.privateVar.push(this.parseVar('private'))}while(this.string.indexOf('super var ')>=0){this.superVar.push(this.parseVar('super'))}while(this.string.indexOf('public function ')>=0){this.publicFct.push(this.parseFunction('public'))}while(this.string.indexOf('private function ')>=0){this.privateFct.push(this.parseFunction('private'))}this.string=this.string.trim().replace(/\n/g,'');if(this.string!==''){throw new Error('Error while parsing Class  > '+this.qualifiedClassName+' <');}return this}ClassParser.prototype.toString=function(){return this.string};ClassParser.prototype.valueOf=function(){return this.string};ClassParser.prototype.parseFunction=function(a,b){var c={};c.body='';c.args='';c.name='';c.str='';c.found=false;var d=a+' function';var e=this.string.indexOf(d+(b?' '+b:''));if(e===-1){return c}var f=this.string.substring(e);var g=f.substring(20).indexOf('public ')+20;var h=f.substring(20).indexOf('private ')+20;var i=f.substring(20).indexOf('static ')+20;if(g<=20){g=(Number.MAX_VALUE||Math.pow(2,50))}if(h<=20){h=(Number.MAX_VALUE||Math.pow(2,50))}if(i<=20){i=(Number.MAX_VALUE||Math.pow(2,50))}var j=Math.min(g,h,i,(f.lastIndexOf('}')+1));f=f.substring(0,j);c.str=f;c.args=f.substring(f.indexOf('(')+1,f.indexOf(')')).trim();c.body=f.substring(f.indexOf('{')+1,f.lastIndexOf('}'));c.name=f.substring(0,f.indexOf('(')).replace(d,'').trim();c.found=true;this.string=this.string.replace(c.str,'');return c};ClassParser.prototype.parseVar=function(a,b){var v={};v.value='';v.name='';v.str='';v.found=false;var c=a+' var';var d=this.string.indexOf(c+(b?' '+b:''));var e=this.string.substring(d);var f=e.indexOf(';')+1;if(d===-1){return v}var g=e.substring(0,f);var h=g.indexOf('=')!==-1;v.str=g;v.name=(h===false?g:g.substring(0,g.indexOf('='))).replace('=','').replace(';','').replace(c,'').trim();v.value=(h===false?'':g.substring(g.indexOf('='))).replace('=','').replace(';','').trim();v.found=true;if(v.value===''){v.value='null'}this.string=this.string.replace(v.str,'');return v};ClassParser.prototype.fetchResource=function(a){var b=this.string.indexOf(a);if(b===-1){return''}var c=this.string.substring(b);c=c.substring(0,c.indexOf(';')+1);this.string=this.string.replace(c,'');return c.replace(a,'').replace(';','').replace(/\'/g,'').replace(/\"/g,'').trim()};ClassParser.prototype.parse=function(){var i,j,classBody='';var a=this;var b=a.privateVar.concat(a.privateFct);var c=a.publicVar.concat(a.publicFct);var d=[];var f=[];for(i=0;i<a.imports.length;i++){d.push("'"+a.imports[i].replace(/\./g,'/')+"'")}for(i=0;i<a.includes.length;i++){d.push("'"+a.includes[i]+"'")}if(a.pkg!==''){var g=a.pkg.split('.');var h='';for(i=0;i<g.length;i++){if(i!==0){h+='.'}h+=g[i];classBody+="if (!"+h+") "+(i===0?"var ":"")+h+" = {};\n"}classBody+="\n"+a.pkg+'.'}else{classBody+='var '}classBody+=a.className+" = (function () {";classBody+='"use strict";';for(i=0;i<a.privateStaticFct.length;i++){classBody+='var '+a.privateStaticFct[i].name+' = function('+a.privateStaticFct[i].args+') {';classBody+=a.privateStaticFct[i].body;classBody+='};'}for(i=0;i<a.privateStaticVar.length;i++){classBody+='var '+a.privateStaticVar[i].name+' = '+a.privateStaticVar[i].value+';'}for(i=0;i<a.publicVar.length;i++){if(a.publicVar[i].value!=='null'){classBody+=a.className+'.prototype.'+a.publicVar[i].name+' = '+a.publicVar[i].value+';'}}classBody+='function '+a.className+'('+a.constructorFct.args+') {';classBody+=a.className+'.__super__.constructor.apply(this, arguments);';classBody+='var self = this.self;';classBody+='var priv = self.priv;';if(a.isStaticClass){classBody+=a.className+".instance = this;"}for(i=0;i<a.privateVar.length;i++){classBody+='priv.'+a.privateVar[i].name+' = '+a.privateVar[i].value+';'}for(i=0;i<a.privateFct.length;i++){classBody+='priv.'+a.privateFct[i].name+' = function('+a.privateFct[i].args+') {';classBody+=a.privateFct[i].body;classBody+='};'}classBody+=a.constructorFct.body;classBody+='return this;';classBody+='}';for(i=0;i<a.publicFct.length;i++){classBody+=a.className+'.prototype.'+a.publicFct[i].name+' = function('+a.publicFct[i].args+'){';classBody+='var self = this.self;';classBody+='var priv = this.priv;';classBody+=a.publicFct[i].body;classBody+='};'}for(i=0;i<a.publicStaticVar.length;i++){classBody+=a.className+'.'+a.publicStaticVar[i].name+' = '+a.publicStaticVar[i].value+';'}for(i=0;i<a.publicStaticFct.length;i++){classBody+=a.className+'.'+a.publicStaticFct[i].name+' = function('+a.publicStaticFct[i].args+'){';classBody+=a.publicStaticFct[i].body;classBody+='};'}classBody=classBody.replace(/\s\(/g,'(');classBody=classBody.replace(/\(\s\)/g,'()');for(i=0;i<a.publicFct.length;i++){classBody=classBody.replace(new RegExp('this.'+a.publicFct[i].name+"\\(",'g'),'self.'+a.publicFct[i].name+'.call(self,');classBody=classBody.replace(new RegExp("\\b"+'this.'+a.publicFct[i].name+"\\b",'g'),'self.'+a.publicFct[i].name+'.bind(self)')}for(i=0;i<a.superVar.length;i++){classBody=classBody.replace(new RegExp('super.'+a.superVar[i].name,'g'),'self.'+a.superVar[i].name)}for(i=0;i<a.publicVar.length;i++){classBody=classBody.replace(new RegExp('this.'+a.publicVar[i].name,'g'),'self.'+a.publicVar[i].name)}for(i=0;i<b.length;i++){classBody=classBody.replace(new RegExp('this.'+b[i].name,'g'),'self.priv.'+b[i].name)}for(i=0;i<a.styles.length;i++){classBody+=k.NAME+".style('"+a.styles[i]+"');"}classBody+=k.NAME+".defineClass({";classBody+="className: '"+a.qualifiedClassName.replace(/\./g,'/')+"'";classBody+=", classConstructor: "+a.className;classBody+=", superClass: '"+a.superClass.replace(/\./g,'/')+"'";classBody+=", imports: ["+d.join(', ')+"]";classBody+=", plugins: ["+f.join(', ')+"]";if(a.isStaticClass){classBody+=",callback: function(){ new "+a.className+"(); }"}classBody+="});\n";classBody+='return '+a.className+';';classBody+='})();';classBody=classBody.replace(/super\s\(/g,'super(');classBody=classBody.replace(/super\(\s\)/g,'super()');classBody=classBody.replace(/super\(\);/g,'');classBody=classBody.replace(/parent\./g,'super.');classBody=classBody.replace(/super\./g,a.className+".__super__.");classBody=classBody.replace(/(__super__\.)+([\s\S]*?\()/g,'$&.call(self,');classBody=classBody.replace(/apply\(.call\(self,/g,'apply(');classBody=classBody.replace(/\(\.call\(self/g,'.call(self');classBody=classBody.replace(/function\.call\(self,/g,'function(');classBody=classBody.replace(/for\.call\(self,/g,'for (');classBody=classBody.replace(/self,\)/g,'self)');classBody=classBody.replace(/__DOLLAR__/g,'$');classBody=classBody.replace(/dispatchEvent/g,'triggerEvent');classBody=classBody.replace(/addEventListener/g,'signalConnect');classBody=classBody.replace(/removeEventListener/g,'unconnectSignal');if(k.MINIFY_JS){classBody=classBody.replace(/function /g,';function ');classBody=classBody.replace(/\n|\t/g,'');while(classBody.indexOf(';;')>=0){classBody=classBody.replace(/;;/g,';')}}else{try{classBody=l.js_beautify(classBody,{'indent_size':2,'indent_char':' ','preserve_newlines':false})}catch(e){}}return classBody};return ClassParser}(app,window));